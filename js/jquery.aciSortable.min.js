
/*
 * aciSortable jQuery Plugin v1.8.0
 * http://acoderinsights.ro
 *
 * Copyright (c) 2015 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library >= v1.7.1 http://jquery.com
 * + aciPlugin >= v1.4.0 https://github.com/dragosu/jquery-aciPlugin
 */

!function(t,i,e){var n={container:"ul",item:"li",distance:4,handle:"*",disable:"a,input,textarea,select,option,button",child:null,childHolder:'<ul class="aciSortableChild"></ul>',childHolderSelector:".aciSortableChild",exclude:null,vertical:!0,placeholder:'<li class="aciSortablePlaceholder"><div></div></li>',placeholderSelector:".aciSortablePlaceholder",helper:'<div class="aciSortableHelper"></div>',helperSelector:".aciSortableHelper",relative:!1,draggable:!0,gluedPlaceholder:!1,connectDrop:null,dropPosition:null,simpleDrop:null,scroll:80,scrollParent:"window",before:function(t){if(this.options().exclude){var i=this.containerFrom(t);return!i.is(this.options().exclude)&&!t.is(this.options().exclude)}return!0},start:function(t,i,e){var n=t.clone();n.children(this.options().container).remove(),e.html(n.text())},valid:function(t,i,e,n,s,o){if(this.options().exclude){if(n&&null!==e)return!i.is(this.options().exclude);var h=this.containerFrom(i);return!h.is(this.options().exclude)}return!0},drag:function(t,i,e,n){},create:function(t,i){return i.append(this.options().childHolder),!0},remove:function(t,i){i.children(this.options().childHolderSelector).remove()},end:function(t,i,e,n){e.parent().length&&e.after(t).detach(),n.detach()}},s={__extend:function(){t.extend(this._instance,{sorting:!1,item:null,hoverItem:null,isContainer:!1,pointStart:null,pointNow:null,placeholder:null,helper:null,relative:null,children:null,scroll:!1,lastCheck:{}})},init:function(){this.wasInit()||(this._instance.jQuery.on("mousedown"+this._instance.nameSpace,this.options().item,this.proxy(function(e){var n=t(e.target);n.is(this.options().handle)&&!n.is(this.options().disable)&&(n.is(this.options().disable)||e.preventDefault(),n.is(this.options().container)?t(i.document.body).css("cursor","no-drop"):this._delayStart(e))})).on("mousemove"+this._instance.nameSpace,this.options().item,this.proxy(function(t){if(this.isActive()){t.stopPropagation(),this._instance.isContainer=!1;var i=this.itemFrom(t.target);if(this._instance.item.has(i).length)this._instance.hoverItem=null;else if(null===this.options().dropPosition)this._instance.hoverItem=i;else{var e=this.containerFrom(t.target);this._dropPosition(e)}}this._drag(t)})).on("mousemove"+this._instance.nameSpace,this.options().container,this.proxy(function(t){if(this.isActive()){t.stopPropagation();var i=this.containerFrom(t.target);this._instance.item.has(i).length?this._instance.hoverItem=null:this.isEmpty(i)?(this._instance.hoverItem=i,this._instance.isContainer=!0):(this._instance.isContainer=!1,null===this.options().dropPosition?this._instance.hoverItem=this._closestFrom(t):this._dropPosition(i))}this._drag(t)})),this._initConnect(),this._initSimple(),t(i.document).bind("mousemove"+this._instance.nameSpace+this._instance.index,this.proxy(function(t){this.isActive()&&(this._instance.hoverItem=null,this._drag(t))})).on("mousemove"+this._instance.nameSpace+this._instance.index,this.options().helperSelector,this.proxy(function(i){if(this.isActive()){var e=this._fromCursor(i);e&&(this._instance.jQuery.trigger(t.Event("mousemove",{target:e,pageX:i.pageX,pageY:i.pageY})),i.stopPropagation())}})).bind("selectstart"+this._instance.nameSpace+this._instance.index,this.proxy(function(t){this.isActive()&&t.preventDefault()})).bind("mouseup"+this._instance.nameSpace+this._instance.index,this.proxy(function(){this.isActive()?this._end():(this._instance.item=null,t(i.document.body).css("cursor","default"))})),this._super())},_dropPosition:function(t){-1==this.options().dropPosition?this._instance.hoverItem=this._firstItem(t):this._instance.hoverItem=this._lastItem(t),this._instance.hoverItem.length||(this._instance.hoverItem=t,this._instance.isContainer=!0)},_firstItem:function(t){return t.children(this.options().item).not(this.options().placeholderSelector).first()},_lastItem:function(t){return t.children(this.options().item).not(this.options().placeholderSelector).last()},_closestFrom:function(e){var n=null,s=t(e.target);if(this.options().vertical){var o=t(i).scrollTop(),h=s.height();s.find(this.options().item).not(this.options().placeholderSelector).each(function(){var s=this.getBoundingClientRect(),a=i.Math.abs(o+s.top+(s.bottom-s.top)/2-e.pageY);h>a&&(h=a,n=t(this))})}else{var o=t(i).scrollLeft(),h=s.width();s.find(this.options().item).not(this.options().placeholderSelector).each(function(){var s=this.getBoundingClientRect(),a=i.Math.abs(o+s.left+(s.right-s.left)/2-e.pageX);h>a&&(h=a,n=t(this))})}return n},_fromCursor:function(e){if(this._instance.helper&&this._instance.helper.parent().length&&t(e.target).closest(this.options().helperSelector).length){this._instance.helper.hide();var n=i.document.elementFromPoint(e.clientX,e.clientY);if(this._instance.helper.show(),n&&n!=i.document.body)return n}return null},_initConnect:function(){this.options().connectDrop&&t(i.document).on("mousemove"+this._instance.nameSpace+"connect"+this._instance.index,this.options().connectDrop,this.proxy(function(i){var e=t(i.target);this.isActive()&&!this._instance.jQuery.has(e).length&&(e.is(this.options().connectDrop)||(e=e.closest(this.options().connectDrop)),this._connect(e))}))},_doneConnect:function(){t(i.document).off(this._instance.nameSpace+"connect"+this._instance.index)},_initSimple:function(){this.options().simpleDrop&&t(i.document).on("mousemove"+this._instance.nameSpace+"simple"+this._instance.index,this.options().simpleDrop,this.proxy(function(i){var e=t(i.target);this.isActive()&&!this._instance.jQuery.has(e).length&&(i.stopPropagation(),e.is(this.options().simpleDrop)||(e=e.closest(this.options().simpleDrop)),this._instance.hoverItem=e,this._instance.isContainer=!1),this._drag(i)}))},_doneSimple:function(){t(i.document).off(this._instance.nameSpace+"simple"+this._instance.index)},_trigger:function(i,e){var n=t.Event("acisortable");return this._instance.jQuery.trigger(n,[this,i,e]),!n.isDefaultPrevented()},_call:function(t,i){var e=[];for(var n in i)e.push(i[n]);var s=!0;return this._trigger("before"+t,i)?(this._instance.options[t]&&(s=this._instance.options[t].apply(this,e)),this._trigger(t,i)||(s=!1),s):!1},_connect:function(e){var n=e.aciSortable("api");if(n.wasInit()){n._instance.item=this._instance.item,n._instance.pointStart=this._instance.pointStart,n._instance.relative=this._instance.relative,n._instance.helper=this._instance.helper.clone();var s=t('<div style="display:none"></div>');t(i.document.body).append(s),this._instance.item=s,this._instance.placeholder.detach(),this._instance.helper.detach(),this._end(),s.remove(),n._start()}},hasItem:function(t){return this._instance.jQuery.has(t).length>0},sortableFrom:function(i){return this._instance.jQuery.has(i).length?this._instance.jQuery:this.options().connectDrop?t(i).closest(this.options().connectDrop):t()},itemFrom:function(i){return t(i).closest(this.options().item)},containerFrom:function(i){return t(i).closest(this.options().container)},hasChildrens:function(t){return t.children(this.options().container).children(this.options().item).not(this.options().placeholderSelector).length>0},hasContainer:function(t){return t.children(this.options().container).length>0},isEmpty:function(t){return!t.children(this.options().item).not(this.options().placeholderSelector).length},isActive:function(){return this._instance.sorting},cancel:function(){this.isActive()&&(this._instance.placeholder.parent().length&&this._instance.placeholder.detach(),this._end())},end:function(){this.isActive()&&this._end()},_delayStart:function(e){var n=this.itemFrom(e.target);if(this._call("before",{item:n})){if(this._instance.item=n,this._instance.pointStart={x:e.pageX,y:e.pageY},this.options().relative){var s=t(i).scrollTop(),o=t(i).scrollLeft(),h=this._instance.item.get(0).getBoundingClientRect();this._instance.relative={x:h.left+o-e.pageX,y:h.top+s-e.pageY}}else this._instance.relative={x:0,y:0};this._drag(e)}else t(i.document.body).css("cursor","no-drop")},_start:function(){this._instance.sorting=!0,this._instance.placeholder||(this._instance.placeholder=t(this.options().placeholder)),this._instance.helper||(this._instance.helper=t(this.options().helper)),this._call("start",{item:this._instance.item,placeholder:this._instance.placeholder,helper:this._instance.helper}),this.options().gluedPlaceholder&&this._instance.item.after(this._instance.placeholder),t(i.document.body).append(this._instance.helper),t(i.document.body).css("cursor","move")},_minDistance:function(){return i.Math.abs(this._instance.pointStart.x-this._instance.pointNow.x)>this.options().distance||i.Math.abs(this._instance.pointStart.y-this._instance.pointNow.y)>this.options().distance},_drag:function(t){this._instance.pointNow={x:t.pageX,y:t.pageY},this.isActive()?(this._helper(),this._placeholder()):this._instance.item&&this._minDistance()&&this._start()},_onDrag:function(t){this._call("drag",{item:this._instance.item,placeholder:this._instance.placeholder,isValid:t,helper:this._instance.helper})},_isValid:function(e,n){return!this.options().draggable&&this.hasItem(this._instance.item)&&(this._instance.isContainer||this.containerFrom(this._instance.item).get(0)!=this.containerFrom(this._instance.hoverItem).get(0))||this._instance.item.has(this._instance.hoverItem).length?!1:this._call("valid",{item:this._instance.item,hover:this._instance.hoverItem,before:n?null:null===e?!1:e,isContainer:n?!0:this._instance.isContainer,placeholder:this._instance.placeholder,helper:this._instance.helper})?(t(i.document.body).css("cursor","move"),!0):!1},_onCreate:function(){return this._onRemove(),this._isSimple()?!1:this._call("create",{item:this._instance.item,hover:this._instance.hoverItem})?(this._instance.childItem=this._instance.hoverItem,this._instance.hoverItem=this._instance.hoverItem.children(this.options().childHolderSelector),this._instance.isContainer=!0,this._placeholder(),!0):!1},_onRemove:function(t){!this._instance.childItem||t&&t.get(0)==this._instance.childItem.get(0)||(this._instance.placeholder&&this._instance.placeholder.detach(),this.hasChildrens(this._instance.childItem)||this._call("remove",{item:this._instance.item,hover:this._instance.childItem}),this._instance.childItem=null)},_wasValid:function(t,i,e){if(this._instance.lastCheck)var n=e?this._instance.lastCheck.check:this._instance.lastCheck.normal,s=n&&n.hoverItem.get(0)==this._instance.hoverItem.get(0)&&n.before===t&&n.create===i&&n.isContainer==this._instance.isContainer;return this._instance.lastCheck[e?"check":"normal"]={hoverItem:this._instance.hoverItem,before:t,create:i,isContainer:this._instance.isContainer},s},_isSimple:function(){return this.options().simpleDrop&&this._instance.hoverItem&&this._instance.hoverItem.is(this.options().simpleDrop)},_placeholder:function(){if(this._instance.pointStart=this._instance.pointNow,this._instance.hoverItem){if(this._instance.hoverItem.is(this.options().placeholderSelector))return;if(this._instance.isContainer){if(this._wasValid(null,!1))return;if(this._isValid(null))return this._instance.hoverItem.append(this._instance.placeholder),void this._onDrag(!0)}else if(this._instance.hoverItem.get(0)!=this._instance.item.get(0)){var e=!1,n=!1,s=this._instance.hoverItem.get(0).getBoundingClientRect(),o=this._instance.hoverItem.children(this.options().container);if(this.options().vertical){var h=t(i).scrollTop(),a=s.bottom-(o.length&&o.is(":visible")?o.outerHeight(!0):0);if(this.options().child&&(this.options().draggable||!this.hasItem(this._instance.item))&&!this.hasChildrens(this._instance.hoverItem)){var r=(a-s.top)*(.5-this.options().child/200);this._instance.pointNow.y>h+s.top+r&&this._instance.pointNow.y<h+a-r&&(n=o.length?null:!0)}this._instance.pointNow.y<h+s.top+(a-s.top)/2&&(e=!0)}else{var h=t(i).scrollLeft(),c=s.right-(o.length&&o.is(":visible")?o.outerWidth(!0):0);if(this.options().child&&(this.options().draggable||!this.hasItem(this._instance.item))&&!this.hasChildrens(this._instance.hoverItem)){var r=(c-s.left)*(.5-this.options().child/200);(this._instance.pointNow.x>h+s.left+r||this._instance.pointNow.x<h+c-r)&&(n=o.length?null:!0)}this._instance.pointNow.x<h+s.left+(c-s.left)/2&&(e=!0)}if(-1==this.options().dropPosition?e=!0:1==this.options().dropPosition&&(e=!1),n!==!1){if(this._wasValid(e,n,!0))return;this._isValid(null,!0)===!1&&(n=!1)}if(null===n){if(this._onRemove(this._instance.hoverItem),this._instance.childItem=this._instance.hoverItem,this._instance.hoverItem=this._instance.hoverItem.children(this.options().childHolderSelector),this._instance.isContainer=!0,this._wasValid(null,!0))return;if(this._isValid(null))return this._isSimple()||this._instance.hoverItem.append(this._instance.placeholder),void this._onDrag(!0)}else if(e){if(this._wasValid(!0,n))return;if(this._isValid(!0)){if(n&&this._onCreate())return;if(this._prevItem())return}else{if(this._isValid(null,!0)&&this._onCreate())return;if(this._isValid(!1)&&this._nextItem())return}}else{if(this._wasValid(!1,n))return;if(this._isValid(!1)){if(n&&this._onCreate())return;if(this._nextItem())return}else{if(this._isValid(null,!0)&&this._onCreate())return;if(this._isValid(!0)&&this._prevItem())return}}}}else this._instance.lastCheck={};this.options().gluedPlaceholder||this._instance.placeholder.detach(),t(i.document.body).css("cursor","no-drop"),this._onDrag(!1)},_prevItem:function(){var t=this._instance.hoverItem.prev(this.options().item);return this.options().gluedPlaceholder||t.get(0)!=this._instance.item.get(0)?(this._isSimple()||this._instance.hoverItem.before(this._instance.placeholder),this._onDrag(!0),!0):!1},_nextItem:function(){var t=this._instance.hoverItem.next(this.options().item);return this.options().gluedPlaceholder||t.get(0)!=this._instance.item.get(0)?(this._isSimple()||this._instance.hoverItem.after(this._instance.placeholder),this._onDrag(!0),!0):!1},_scrollParent:function(e){if(e)e=e.parents(this.options().scrollParent).first();else var e=this._instance.jQuery.parents(this.options().scrollParent).first();if(e.length){if(!this._scrollContainer(e))return e}else this.options().scrollParent.match(/^(.*,)?window(,.*)?$/)&&this._scrollContainer(t(i),!0);return null},_amount:function(t,e){return t/(1+i.Math.pow(1.04,-e+60))},_scrollContainer:function(e,n){var s=!1,o=t(i).scrollTop(),h=t(i).scrollLeft(),a=e.height(),r=e.width(),c=n?i.document.body.scrollHeight:e.get(0).scrollHeight,l=i.Math.min(this.options().scroll,a/3),p=n?{left:0,top:0,right:r,bottom:a}:e.get(0).getBoundingClientRect();if(c>a&&this._instance.pointNow.x>h+p.left&&this._instance.pointNow.x<h+p.right){var _=e.scrollTop();if(this._instance.pointNow.y<o+p.top+l){if(_>0){var d=o+p.top+l-this._instance.pointNow.y;e.scrollTop(i.Math.max(_-this._amount(l,d),0)),s=!0}}else if(this._instance.pointNow.y>o+p.bottom-l&&c>_+a){var d=this._instance.pointNow.y-(o+p.bottom-l);e.scrollTop(i.Math.min(_+this._amount(l,d),c-a)),s=!0}}var u=n?i.document.body.scrollWidth:e.get(0).scrollWidth;if(l=i.Math.min(this.options().scroll,r/3),u>r&&this._instance.pointNow.y>o+p.top&&this._instance.pointNow.y<o+p.bottom){var _=e.scrollLeft();if(this._instance.pointNow.x<h+p.left+l){if(_>0){var d=h+p.left+l-this._instance.pointNow.x;e.scrollLeft(i.Math.max(_-this._amount(l,d),0)),s=!0}}else if(this._instance.pointNow.x>h+p.right-l&&u>_+r){var d=this._instance.pointNow.x-(h+p.right-l);e.scrollLeft(i.Math.min(_+this._amount(l,d),u-r)),s=!0}}return n&&s&&(this._instance.pointNow.x+=e.scrollLeft()-h,this._instance.pointNow.y+=e.scrollTop()-o),s},_scroll:function(){if(!this._instance.scroll){if(this._instance.scroll=!0,!this._scrollContainer(this._instance.jQuery)&&this.options().scrollParent)for(var t=null;;)if(t=this._scrollParent(t),null===t)break;this.isActive()?i.setTimeout(this.proxy(function(){this._instance.scroll=!1,this._helper()}),50):this._instance.scroll=!1}},_helper:function(){this.options().scroll&&this._scroll(),this._instance.helper.css({left:this._instance.pointNow.x+this._instance.relative.x+"px",top:this._instance.pointNow.y+this._instance.relative.y+"px"})},_end:function(){this._instance.placeholder.parent().length&&(this._instance.placeholder.prev(this.options().item).get(0)==this._instance.item.get(0)||this._instance.placeholder.next(this.options().item).get(0)==this._instance.item.get(0))&&this._instance.placeholder.detach();var e=this.containerFrom(this._instance.item);this._call("end",{item:this._instance.item,hover:this._instance.hoverItem,placeholder:this._instance.placeholder,helper:this._instance.helper}),this._onRemove();var n=this.itemFrom(e);n.length&&!this.hasChildrens(n)&&(this._instance.childItem=n,this._onRemove()),this._instance.sorting=!1,this._instance.item=null,this._instance.hoverItem=null,this._instance.lastCheck={},t(i.document.body).css("cursor","default")},option:function(t,i){if(this.wasInit())switch(t){case"connectDrop":i!=this.options().connectDrop&&(this._doneConnect(),this.options().connectDrop=i,this._initConnect());break;case"simpleDrop":i!=this.options().simpleDrop&&(this._doneSimple(),this.options().simpleDrop=i,this._initSimple())}this._super(t,i)},destroy:function(){this.wasInit()&&(this._instance.jQuery.off(this._instance.nameSpace),this._doneConnect(),t(i.document).unbind(this._instance.nameSpace+this._instance.index).off(this._instance.nameSpace+this._instance.index),this._instance.placeholder&&this._instance.placeholder.detach(),this._instance.helper&&this._instance.helper.detach(),this._super())}};aciPluginClass.plugins.aciSortable=aciPluginClass.aciPluginUi.extend(s,"aciSortable"),aciPluginClass.publish("aciSortable",n)}(jQuery,this);
