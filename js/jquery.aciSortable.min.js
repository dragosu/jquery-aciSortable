
/*
 * aciSortable jQuery Plugin v1.7.0
 * http://acoderinsights.ro
 *
 * Copyright (c) 2015 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library >= v1.7.1 http://jquery.com
 * + aciPlugin >= v1.4.0 https://github.com/dragosu/jquery-aciPlugin
 */

!function(t,i,n){var e={container:"ul",item:"li",distance:4,handle:"*",disable:"a,input,textarea,select,option,button",child:null,childHolder:'<ul class="aciSortableChild"></ul>',childHolderSelector:".aciSortableChild",exclude:null,vertical:!0,placeholder:'<li class="aciSortablePlaceholder"><div></div></li>',placeholderSelector:".aciSortablePlaceholder",helper:'<div class="aciSortableHelper"></div>',helperSelector:".aciSortableHelper",relative:!1,draggable:!0,gluedPlaceholder:!1,connectDrop:null,dropPosition:null,simpleDrop:null,scroll:80,scrollParent:"window",before:function(t){if(this._instance.options.exclude){var i=this.containerFrom(t);return!i.is(this._instance.options.exclude)&&!t.is(this._instance.options.exclude)}return!0},start:function(t,i,n){var e=t.clone();e.children(this._instance.options.container).remove(),n.html(e.text())},valid:function(t,i,n,e,s,o){if(this._instance.options.exclude){if(e&&null!==n)return!i.is(this._instance.options.exclude);var a=this.containerFrom(i);return!a.is(this._instance.options.exclude)}return!0},drag:function(t,i,n,e){},create:function(t,i){return i.append(this._instance.options.childHolder),!0},remove:function(t,i){i.children(this._instance.options.childHolderSelector).remove()},end:function(t,i,n,e){n.parent().length&&n.after(t).detach(),e.detach()}},s={__extend:function(){t.extend(this._instance,{sorting:!1,item:null,hoverItem:null,isContainer:!1,pointStart:null,pointNow:null,placeholder:null,helper:null,relative:null,children:null,scroll:!1,lastCheck:{}})},init:function(){this.wasInit()||(this._instance.jQuery.on("mousedown"+this._instance.nameSpace,this._instance.options.item,this.proxy(function(n){var e=t(n.target);e.is(this._instance.options.handle)&&!e.is(this._instance.options.disable)&&(e.is(this._instance.options.disable)||n.preventDefault(),e.is(this._instance.options.container)?t(i.document.body).css("cursor","no-drop"):this._delayStart(n))})).on("mousemove"+this._instance.nameSpace,this._instance.options.item,this.proxy(function(t){if(this._instance.sorting){t.stopPropagation(),this._instance.isContainer=!1;var i=this.itemFrom(t.target);if(this._instance.item.has(i).length)this._instance.hoverItem=null;else if(null===this._instance.options.dropPosition)this._instance.hoverItem=i;else{var n=this.containerFrom(t.target);this._dropPosition(n)}}this._drag(t)})).on("mousemove"+this._instance.nameSpace,this._instance.options.container,this.proxy(function(t){if(this._instance.sorting){t.stopPropagation();var i=this.containerFrom(t.target);this._instance.item.has(i).length?this._instance.hoverItem=null:this.isEmpty(i)?(this._instance.hoverItem=i,this._instance.isContainer=!0):(this._instance.isContainer=!1,null===this._instance.options.dropPosition?this._instance.hoverItem=this._closestFrom(t):this._dropPosition(i))}this._drag(t)})),this._initConnect(),this._initSimple(),t(i.document).bind("mousemove"+this._instance.nameSpace+this._instance.index,this.proxy(function(t){this._instance.sorting&&(this._instance.hoverItem=null,this._drag(t))})).on("mousemove"+this._instance.nameSpace+this._instance.index,this._instance.options.helperSelector,this.proxy(function(i){if(this._instance.sorting){var n=this._fromCursor(i);n&&(this._instance.jQuery.trigger(t.Event("mousemove",{target:n,pageX:i.pageX,pageY:i.pageY})),i.stopPropagation())}})).bind("selectstart"+this._instance.nameSpace+this._instance.index,this.proxy(function(t){this._instance.sorting&&t.preventDefault()})).bind("mouseup"+this._instance.nameSpace+this._instance.index,this.proxy(function(){this._instance.sorting?this._end():(this._instance.item=null,t(i.document.body).css("cursor","default"))})),this._super())},_dropPosition:function(t){-1==this._instance.options.dropPosition?this._instance.hoverItem=this._firstItem(t):this._instance.hoverItem=this._lastItem(t),this._instance.hoverItem.length||(this._instance.hoverItem=t,this._instance.isContainer=!0)},_firstItem:function(t){return t.children(this._instance.options.item).not(this._instance.options.placeholderSelector).first()},_lastItem:function(t){return t.children(this._instance.options.item).not(this._instance.options.placeholderSelector).last()},_closestFrom:function(n){var e=null,s=t(n.target);if(this._instance.options.vertical){var o=t(i).scrollTop(),a=s.height();s.find(this._instance.options.item).not(this._instance.options.placeholderSelector).each(function(){var s=this.getBoundingClientRect(),c=i.Math.abs(o+s.top+(s.bottom-s.top)/2-n.pageY);a>c&&(a=c,e=t(this))})}else{var o=t(i).scrollLeft(),a=s.width();s.find(this._instance.options.item).not(this._instance.options.placeholderSelector).each(function(){var s=this.getBoundingClientRect(),c=i.Math.abs(o+s.left+(s.right-s.left)/2-n.pageX);a>c&&(a=c,e=t(this))})}return e},_fromCursor:function(n){if(this._instance.helper&&this._instance.helper.parent().length&&t(n.target).closest(this._instance.options.helperSelector).length){this._instance.helper.hide();var e=i.document.elementFromPoint(n.clientX,n.clientY);if(this._instance.helper.show(),e&&e!=i.document.body)return e}return null},_initConnect:function(){this._instance.options.connectDrop&&t(i.document).on("mousemove"+this._instance.nameSpace+"connect"+this._instance.index,this._instance.options.connectDrop,this.proxy(function(i){var n=t(i.target);this._instance.sorting&&!this._instance.jQuery.has(n).length&&(n.is(this._instance.options.connectDrop)||(n=n.closest(this._instance.options.connectDrop)),this._connect(n))}))},_doneConnect:function(){t(i.document).off(this._instance.nameSpace+"connect"+this._instance.index)},_initSimple:function(){this._instance.options.simpleDrop&&t(i.document).on("mousemove"+this._instance.nameSpace+"simple"+this._instance.index,this._instance.options.simpleDrop,this.proxy(function(i){var n=t(i.target);this._instance.sorting&&!this._instance.jQuery.has(n).length&&(i.stopPropagation(),n.is(this._instance.options.simpleDrop)||(n=n.closest(this._instance.options.simpleDrop)),this._instance.hoverItem=n,this._instance.isContainer=!1),this._drag(i)}))},_doneSimple:function(){t(i.document).off(this._instance.nameSpace+"simple"+this._instance.index)},_trigger:function(i,n){var e=t.Event("acisortable");return this._instance.jQuery.trigger(e,[this,i,n]),!e.isDefaultPrevented()},_call:function(t,i){var n=[];for(var e in i)n.push(i[e]);var s=!0;return this._trigger("before"+t,i)?(this._instance.options[t]&&(s=this._instance.options[t].apply(this,n)),this._trigger(t,i)||(s=!1),s):!1},_connect:function(n){var e=n.aciSortable("api");if(e.wasInit()){e._instance.item=this._instance.item,e._instance.pointStart=this._instance.pointStart,e._instance.relative=this._instance.relative,e._instance.helper=this._instance.helper.clone();var s=t('<div style="display:none"></div>');t(i.document.body).append(s),this._instance.item=s,this._instance.placeholder.detach(),this._instance.helper.detach(),this._end(),s.remove(),e._start()}},hasItem:function(t){return this._instance.jQuery.has(t).length>0},sortableFrom:function(i){return this._instance.jQuery.has(i).length?this._instance.jQuery:this._instance.options.connectDrop?t(i).closest(this._instance.options.connectDrop):t()},itemFrom:function(i){return t(i).closest(this._instance.options.item)},containerFrom:function(i){return t(i).closest(this._instance.options.container)},hasChildrens:function(t){return t.children(this._instance.options.container).children(this._instance.options.item).not(this._instance.options.placeholderSelector).length>0},hasContainer:function(t){return t.children(this._instance.options.container).length>0},isEmpty:function(t){return!t.children(this._instance.options.item).not(this._instance.options.placeholderSelector).length},_delayStart:function(n){var e=this.itemFrom(n.target);if(this._call("before",{item:e})){if(this._instance.item=e,this._instance.pointStart={x:n.pageX,y:n.pageY},this._instance.options.relative){var s=t(i).scrollTop(),o=t(i).scrollLeft(),a=this._instance.item.get(0).getBoundingClientRect();this._instance.relative={x:a.left+o-n.pageX,y:a.top+s-n.pageY}}else this._instance.relative={x:0,y:0};this._drag(n)}else t(i.document.body).css("cursor","no-drop")},_start:function(){this._instance.sorting=!0,this._instance.placeholder||(this._instance.placeholder=t(this._instance.options.placeholder)),this._instance.helper||(this._instance.helper=t(this._instance.options.helper)),this._call("start",{item:this._instance.item,placeholder:this._instance.placeholder,helper:this._instance.helper}),this._instance.options.gluedPlaceholder&&this._instance.item.after(this._instance.placeholder),t(i.document.body).append(this._instance.helper),t(i.document.body).css("cursor","move")},_minDistance:function(){return i.Math.abs(this._instance.pointStart.x-this._instance.pointNow.x)>this._instance.options.distance||i.Math.abs(this._instance.pointStart.y-this._instance.pointNow.y)>this._instance.options.distance},_drag:function(t){this._instance.pointNow={x:t.pageX,y:t.pageY},this._instance.sorting?(this._helper(),this._placeholder()):this._instance.item&&this._minDistance()&&this._start()},_onDrag:function(t){this._call("drag",{item:this._instance.item,placeholder:this._instance.placeholder,isValid:t,helper:this._instance.helper})},_isValid:function(n,e){return!this._instance.options.draggable&&this.hasItem(this._instance.item)&&(this._instance.isContainer||this.containerFrom(this._instance.item).get(0)!=this.containerFrom(this._instance.hoverItem).get(0))||this._instance.item.has(this._instance.hoverItem).length?!1:this._call("valid",{item:this._instance.item,hover:this._instance.hoverItem,before:e?null:null===n?!1:n,isContainer:e?!0:this._instance.isContainer,placeholder:this._instance.placeholder,helper:this._instance.helper})?(t(i.document.body).css("cursor","move"),!0):!1},_onCreate:function(){return this._onRemove(),this._isSimple()?!1:this._call("create",{item:this._instance.item,hover:this._instance.hoverItem})?(this._instance.childItem=this._instance.hoverItem,this._instance.hoverItem=this._instance.hoverItem.children(this._instance.options.childHolderSelector),this._instance.isContainer=!0,this._placeholder(),!0):!1},_onRemove:function(t){!this._instance.childItem||t&&t.get(0)==this._instance.childItem.get(0)||(this._instance.placeholder&&this._instance.placeholder.detach(),this.hasChildrens(this._instance.childItem)||this._call("remove",{item:this._instance.item,hover:this._instance.childItem}),this._instance.childItem=null)},_wasValid:function(t,i,n){if(this._instance.lastCheck)var e=n?this._instance.lastCheck.check:this._instance.lastCheck.normal,s=e&&e.hoverItem.get(0)==this._instance.hoverItem.get(0)&&e.before===t&&e.create===i&&e.isContainer==this._instance.isContainer;return this._instance.lastCheck[n?"check":"normal"]={hoverItem:this._instance.hoverItem,before:t,create:i,isContainer:this._instance.isContainer},s},_isSimple:function(){return this._instance.options.simpleDrop&&this._instance.hoverItem&&this._instance.hoverItem.is(this._instance.options.simpleDrop)},_placeholder:function(){if(this._instance.pointStart=this._instance.pointNow,this._instance.hoverItem){if(this._instance.hoverItem.is(this._instance.options.placeholderSelector))return;if(this._instance.isContainer){if(this._wasValid(null,!1))return;if(this._isValid(null))return this._instance.hoverItem.append(this._instance.placeholder),void this._onDrag(!0)}else if(this._instance.hoverItem.get(0)!=this._instance.item.get(0)){var n=!1,e=!1,s=this._instance.hoverItem.get(0).getBoundingClientRect(),o=this._instance.hoverItem.children(this._instance.options.container);if(this._instance.options.vertical){var a=t(i).scrollTop(),c=s.bottom-(o.length&&o.is(":visible")?o.outerHeight(!0):0);if(this._instance.options.child&&(this._instance.options.draggable||!this.hasItem(this._instance.item))&&!this.hasChildrens(this._instance.hoverItem)){var h=(c-s.top)*(.5-this._instance.options.child/200);this._instance.pointNow.y>a+s.top+h&&this._instance.pointNow.y<a+c-h&&(e=o.length?null:!0)}this._instance.pointNow.y<a+s.top+(c-s.top)/2&&(n=!0)}else{var a=t(i).scrollLeft(),r=s.right-(o.length&&o.is(":visible")?o.outerWidth(!0):0);if(this._instance.options.child&&(this._instance.options.draggable||!this.hasItem(this._instance.item))&&!this.hasChildrens(this._instance.hoverItem)){var h=(r-s.left)*(.5-this._instance.options.child/200);(this._instance.pointNow.x>a+s.left+h||this._instance.pointNow.x<a+r-h)&&(e=o.length?null:!0)}this._instance.pointNow.x<a+s.left+(r-s.left)/2&&(n=!0)}if(-1==this._instance.options.dropPosition?n=!0:1==this._instance.options.dropPosition&&(n=!1),e!==!1){if(this._wasValid(n,e,!0))return;this._isValid(null,!0)===!1&&(e=!1)}if(null===e){if(this._onRemove(this._instance.hoverItem),this._instance.childItem=this._instance.hoverItem,this._instance.hoverItem=this._instance.hoverItem.children(this._instance.options.childHolderSelector),this._instance.isContainer=!0,this._wasValid(null,!0))return;if(this._isValid(null))return this._isSimple()||this._instance.hoverItem.append(this._instance.placeholder),void this._onDrag(!0)}else if(n){if(this._wasValid(!0,e))return;if(this._isValid(!0)){if(e&&this._onCreate())return;if(this._prevItem())return}else{if(this._isValid(null,!0)&&this._onCreate())return;if(this._isValid(!1)&&this._nextItem())return}}else{if(this._wasValid(!1,e))return;if(this._isValid(!1)){if(e&&this._onCreate())return;if(this._nextItem())return}else{if(this._isValid(null,!0)&&this._onCreate())return;if(this._isValid(!0)&&this._prevItem())return}}}}else this._instance.lastCheck={};this._instance.options.gluedPlaceholder||this._instance.placeholder.detach(),t(i.document.body).css("cursor","no-drop"),this._onDrag(!1)},_prevItem:function(){var t=this._instance.hoverItem.prev(this._instance.options.item);return this._instance.options.gluedPlaceholder||t.get(0)!=this._instance.item.get(0)?(this._isSimple()||this._instance.hoverItem.before(this._instance.placeholder),this._onDrag(!0),!0):!1},_nextItem:function(){var t=this._instance.hoverItem.next(this._instance.options.item);return this._instance.options.gluedPlaceholder||t.get(0)!=this._instance.item.get(0)?(this._isSimple()||this._instance.hoverItem.after(this._instance.placeholder),this._onDrag(!0),!0):!1},_scrollParent:function(n){if(n)n=n.parents(this._instance.options.scrollParent).first();else var n=this._instance.jQuery.parents(this._instance.options.scrollParent).first();if(n.length){if(!this._scrollContainer(n))return n}else this._instance.options.scrollParent.match(/^(.*,)?window(,.*)?$/)&&this._scrollContainer(t(i),!0);return null},_amount:function(t,n){return t/(1+i.Math.pow(1.04,-n+60))},_scrollContainer:function(n,e){var s=!1,o=t(i).scrollTop(),a=t(i).scrollLeft(),c=n.height(),h=n.width(),r=e?i.document.body.scrollHeight:n.get(0).scrollHeight,l=i.Math.min(this._instance.options.scroll,c/3),_=e?{left:0,top:0,right:h,bottom:c}:n.get(0).getBoundingClientRect();if(r>c&&this._instance.pointNow.x>a+_.left&&this._instance.pointNow.x<a+_.right){var p=n.scrollTop();if(this._instance.pointNow.y<o+_.top+l){if(p>0){var d=o+_.top+l-this._instance.pointNow.y;n.scrollTop(i.Math.max(p-this._amount(l,d),0)),s=!0}}else if(this._instance.pointNow.y>o+_.bottom-l&&r>p+c){var d=this._instance.pointNow.y-(o+_.bottom-l);n.scrollTop(i.Math.min(p+this._amount(l,d),r-c)),s=!0}}var m=e?i.document.body.scrollWidth:n.get(0).scrollWidth;if(l=i.Math.min(this._instance.options.scroll,h/3),m>h&&this._instance.pointNow.y>o+_.top&&this._instance.pointNow.y<o+_.bottom){var p=n.scrollLeft();if(this._instance.pointNow.x<a+_.left+l){if(p>0){var d=a+_.left+l-this._instance.pointNow.x;n.scrollLeft(i.Math.max(p-this._amount(l,d),0)),s=!0}}else if(this._instance.pointNow.x>a+_.right-l&&m>p+h){var d=this._instance.pointNow.x-(a+_.right-l);n.scrollLeft(i.Math.min(p+this._amount(l,d),m-h)),s=!0}}return e&&s&&(this._instance.pointNow.x+=n.scrollLeft()-a,this._instance.pointNow.y+=n.scrollTop()-o),s},_scroll:function(){if(!this._instance.scroll){if(this._instance.scroll=!0,!this._scrollContainer(this._instance.jQuery)&&this._instance.options.scrollParent)for(var t=null;;)if(t=this._scrollParent(t),null===t)break;this._instance.sorting?i.setTimeout(this.proxy(function(){this._instance.scroll=!1,this._helper()}),50):this._instance.scroll=!1}},_helper:function(){this._instance.options.scroll&&this._scroll(),this._instance.helper.css({left:this._instance.pointNow.x+this._instance.relative.x+"px",top:this._instance.pointNow.y+this._instance.relative.y+"px"})},_end:function(){this._instance.placeholder.parent().length&&(this._instance.placeholder.prev(this._instance.options.item).get(0)==this._instance.item.get(0)||this._instance.placeholder.next(this._instance.options.item).get(0)==this._instance.item.get(0))&&this._instance.placeholder.detach();var n=this.containerFrom(this._instance.item);this._call("end",{item:this._instance.item,hover:this._instance.hoverItem,placeholder:this._instance.placeholder,helper:this._instance.helper}),this._onRemove();var e=this.itemFrom(n);e.length&&!this.hasChildrens(e)&&(this._instance.childItem=e,this._onRemove()),this._instance.sorting=!1,this._instance.item=null,this._instance.hoverItem=null,this._instance.lastCheck={},t(i.document.body).css("cursor","default")},option:function(t,i){if(this.wasInit())switch(t){case"connectDrop":i!=this._instance.options.connectDrop&&(this._doneConnect(),this._instance.options.connectDrop=i,this._initConnect());break;case"simpleDrop":i!=this._instance.options.simpleDrop&&(this._doneSimple(),this._instance.options.simpleDrop=i,this._initSimple())}this._super(t,i)},destroy:function(){this.wasInit()&&(this._instance.jQuery.off(this._instance.nameSpace),this._doneConnect(),t(i.document).unbind(this._instance.nameSpace+this._instance.index).off(this._instance.nameSpace+this._instance.index),this._instance.placeholder&&this._instance.placeholder.detach(),this._instance.helper&&this._instance.helper.detach(),this._super())}};aciPluginClass.plugins.aciSortable=aciPluginClass.aciPluginUi.extend(s,"aciSortable"),aciPluginClass.publish("aciSortable",e)}(jQuery,this);
